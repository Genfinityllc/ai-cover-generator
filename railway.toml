[build]
builder = "DOCKERFILE"
buildCommand = "pip install -r requirements.txt"

[deploy]
# Disable health checks to prevent ML loading timeouts
# healthcheckPath = "/health"
# healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Configure for heavy ML workloads
[env]
NIXPACKS_BUILD_TIMEOUT = "3600"
RAILWAY_BUILDPACK_PYTHON_VERSION = "3.11"

[environments.production]
variables = {
  PORT = "8000",
  PYTHONPATH = "/app",
  PYTHONUNBUFFERED = "1"
}

[environments.staging]
variables = {
  PORT = "8000",
  DEBUG = "true",
  PYTHONPATH = "/app",
  PYTHONUNBUFFERED = "1"
}